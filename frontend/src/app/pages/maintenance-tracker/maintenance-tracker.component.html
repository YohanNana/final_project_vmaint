<!-- maintenance-tracker.component.html -->
<app-navbar #navbar></app-navbar>

<!-- maintenance-tracker.component.html -->
  
  <div class="flex">
    
    <app-sidebar [class.hidden]="!navbar.sidebarOpen" class="md:block"></app-sidebar>
  
    <main class="flex-1 p-6">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Maintenance Tracker</h1>
        <button (click)="addMaintenance()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
          <i class="fas fa-plus mr-1"></i> Add Maintenance
        </button>
      </div>
  
      <!-- Filters -->
      <div class="bg-white p-4 rounded-lg shadow mb-6">
        <div class="flex flex-col md:flex-row md:items-center md:space-x-4 space-y-2 md:space-y-0">
          <div class="flex-1">
            <label class="block text-gray-700 mb-1">Vehicle</label>
            <select class="w-full px-3 py-2 border rounded-lg">
              <option>All Vehicles</option>
              <option>Toyota Camry (CAA-5543)</option>
              <option>Toyota Vitz (CAV-4563)</option>
            </select>
          </div>
          <div class="flex-1">
            <label class="block text-gray-700 mb-1">Status</label>
            <select class="w-full px-3 py-2 border rounded-lg">
              <option>All Statuses</option>
              <option>Overdue</option>
              <option>Upcoming</option>
              <option>Completed</option>
            </select>
          </div>
          <div class="flex-1">
            <label class="block text-gray-700 mb-1">Service Type</label>
            <select class="w-full px-3 py-2 border rounded-lg">
              <option>All Types</option>
              <option>Oil Change</option>
              <option>Tire Rotation</option>
              <option>Brake Service</option>
            </select>
          </div>
          <div class="self-end">
            <button class="bg-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300">
              <i class="fas fa-filter mr-1"></i> Filter
            </button>
          </div>
        </div>
      </div>
  
      <!-- Maintenance Cards -->
      <div class="space-y-4">
  
        <!-- Overdue Maintenance -->
        <!-- OVERDUE -->
        <div *ngIf="overdue.length > 0">
          <h2 class="text-xl font-bold mb-3 text-red-600">
            <i class="fas fa-exclamation-circle mr-2"></i> Overdue Maintenance
          </h2>
          <div *ngFor="let m of overdue" class="bg-white border-l-4 border-red-500 p-4 rounded shadow mb-4">
            <div class="flex justify-between items-start">
              <div>
                <h3 class="font-semibold">{{ m.serviceType }}</h3>
                <p class="text-sm text-gray-600">{{ getVehicleDisplay(m.vehicleId) }}</p>
                <p class="text-sm text-gray-600">Due: {{ m.serviceDate | date }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- UPCOMING -->
        <div *ngIf="upcoming.length > 0">
          <h2 class="text-xl font-bold mb-3 text-yellow-600">
            <i class="fas fa-clock mr-2"></i> Upcoming Maintenance
          </h2>
          <div *ngFor="let m of upcoming" class="bg-white border-l-4 border-yellow-500 p-4 rounded shadow mb-4">
            <div class="flex justify-between items-start">
              <div>
                <h3 class="font-semibold">{{ m.serviceType }}</h3>
                <p class="text-sm text-gray-600">{{ getVehicleDisplay(m.vehicleId) }}</p>
                <p class="text-sm text-gray-600">Due: {{ m.serviceDate | date }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- FUTURE -->
        <div *ngIf="future.length > 0">
          <h2 class="text-xl font-bold mb-3 text-blue-600">
            <i class="fas fa-calendar-alt mr-2"></i> Future Maintenance
          </h2>
          <div *ngFor="let m of future" class="bg-white border-l-4 border-blue-500 p-4 rounded shadow mb-4">
            <div class="flex justify-between items-start">
              <div>
                <h3 class="font-semibold">{{ m.serviceType }}</h3>
                <p class="text-sm text-gray-600">{{ getVehicleDisplay(m.vehicleId) }}</p>
                <p class="text-sm text-gray-600">Due: {{ m.serviceDate | date }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      

      
    </main>
  </div>

  <!-- Add Maintenance Modal -->
<div *ngIf="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <h2 class="text-xl font-bold mb-4">Add Maintenance</h2>
    
    <form (ngSubmit)="submitMaintenance()" #maintenanceForm="ngForm">
      <div class="mb-4">
        <label class="block text-sm mb-1">Vehicle</label>
        <select [(ngModel)]="newMaintenance.vehicleId" name="vehicleId" required class="w-full border px-3 py-2 rounded">
          <option *ngFor="let vehicle of vehicles" [value]="vehicle._id">
            {{ vehicle.make }} {{ vehicle.model }} ({{ vehicle.plate }})
          </option>
        </select>
      </div>

      <div class="mb-4">
        <label class="block text-sm mb-1">Service Type</label>
        <input [(ngModel)]="newMaintenance.serviceType" name="serviceType" required class="w-full border px-3 py-2 rounded">
      </div>

      <div class="mb-4">
        <label class="block text-sm mb-1">Service Date</label>
        <input [(ngModel)]="newMaintenance.serviceDate" name="serviceDate" type="date" required class="w-full border px-3 py-2 rounded">
      </div>

      <div class="mb-4">
        <label class="block text-sm mb-1">Mileage</label>
        <input [(ngModel)]="newMaintenance.mileage" name="mileage" type="number" required class="w-full border px-3 py-2 rounded">
      </div>

      <div class="mb-4">
        <label class="block text-sm mb-1">Cost</label>
        <input [(ngModel)]="newMaintenance.cost" name="cost" type="number" required class="w-full border px-3 py-2 rounded">
      </div>

      <div class="flex justify-end space-x-2">
        <button type="button" (click)="closeModal()" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add</button>
      </div>
      <app-maintenance-form 
        *ngIf="showModal" 
        [vehicles]="vehicles" 
        [formData]="newMaintenance"
        (close)="closeModal()" 
        (save)="submitMaintenance()">
      </app-maintenance-form>
    </form>
  </div>
</div>

  